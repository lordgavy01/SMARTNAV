import numpy as np
import cv2

def generate_lidar_image(depths, output_image_path='test.png',base_angle=0):
    n_points = len(depths)
    
    raw_angles = [1.5707963267948966, 1.5066821910073498, 1.442568055219803, 1.3784539194322563, 1.3143397836447095, 1.2502256478571625, 1.1861115120696157, 1.121997376282069, 1.0578832404945222, 0.9937691047069755, 0.9296549689194287, 0.8655408331318818, 0.801426697344335, 0.7373125615567883, 0.6731984257692414, 0.6090842899816946, 0.5449701541941478, 0.48085601840660114, 0.41674188261905437, 0.35262774683150755, 0.2885136110439608, 0.2243994752564138, 0.160285339468867, 0.09617120368132025, 0.032057067893773494, -0.03205706789377327, -0.09617120368132004, -0.1602853394688668, -0.2243994752564138, -0.28851361104396056, -0.3526277468315073, -0.4167418826190541, -0.48085601840660086, -0.5449701541941478, -0.6090842899816944, -0.6731984257692414, -0.7373125615567879, -0.8014266973443348, -0.8655408331318815, -0.9296549689194284, -0.993769104706975, -1.057883240494522, -1.121997376282069, -1.1861115120696155, -1.2502256478571625, -1.314339783644709, -1.378453919432256, -1.4425680552198026, -1.5066821910073496, -1.5707963267948966]
    angles = [angle+base_angle for angle in raw_angles] 
    # Convert the LIDAR depths to Cartesian coordinates
    x_points = depths * np.cos(angles)
    y_points = depths * np.sin(angles)
    
    max_depth = np.max(depths)
    image_size = (300,300,3)
    
    image = np.zeros(image_size, dtype=np.uint8)
    cv2.circle(image, (image_size[0] // 2, image_size[1] // 2), 5, (0, 0, 255), -1)
   
    for x, y in zip(x_points, y_points):
        cv2.circle(image, (int(x) + image_size[0] // 2, int(y) + image_size[1] // 2), 4, (0, 255, 255), -1)
   
    # Save the LIDAR image
    cv2.imwrite(output_image_path, image)



# Simulated LIDAR depth data
# depths = [1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 1000000000.0, 83.48182142774988, 79.24597122916089, 75.71430150234154, 72.77871169238121, 70.35681147660584, 68.38554740221652, 66.81678180085866, 65.61419547414327, 64.75111604202812, 64.2090164429031, 63.97651965065498, 64.04880722607301, 64.42737340382341, 65.12010105896582, 66.14166682343065, 67.51431468415252, 69.26907570649111, 71.44756269522993, 74.10454245576081, 77.31160077298682, 81.16239354665379, 85.78027038837288, 91.32955476485563, 98.03264214319668, 106.19668762288454, 116.25674799824837, 128.84851325069906, 134.79222323097608, 130.09756315670825, 126.2400338914909, 123.12160990366729, 120.66767421532757, 118.82234886230955, 117.54523024369335, 116.80915603277418, 116.59876543209876]
# for i in range(len(depths)):
#     if depths[i]==1000000000.0:
#         depths[i]=0
# Generate the LIDAR image
# generate_lidar_image(depths)
